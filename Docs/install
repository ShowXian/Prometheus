#下载安装包
Promethues:         wget https://prometheus.io/download/prometheus-2.22.0.linux-amd64.tar.gz
Alertmanager:       wget https://prometheus.io/download/alertmanager-0.21.0.linux-amd64.tar.gz
Node_exporter:      wget https://prometheus.io/download/node_exporter-1.0.1.linux-amd64.tar.gz
Windows_exporter:   https://github.com/prometheus-community/windows_exporter/releases,download windows_exporter-0.14.0-386.msi

#解压缩
tar -zxf prometheus-2.22.0.linux-amd64.tar.gz -C /opt
tar -zxf alertmanager-0.21.0.linux-amd64.tar.gz -C /opt
tar -zxf node_exporter-1.0.1.linux-amd64.tar.gz -C /opt
msi文件放在windows下任意路径

#改名
cd /opt
mv prometheus-2.22.0.linux-amd64  promethues
mv alertmanager-0.21.0.linux-amd64 alertmanager
mv node_exporter-1.0.1.linux-amd64 node_exporter

#添加管理用户，配置系统服务，开机自启动
groupadd prometheus
useradd -g prometheus -m -d /root/prometheus -s /sbin/nologin prometheus
chown prometheus.prometheus -R /opt/prometheus
chown prometheus.prometheus -R /opt/node_exporter/
chown prometheus.prometheus -R /opt/aletmanager/

#添加系统服务项
cat > /etc/systemd/system/prometheus.service <<EOF
[Unit]
Description=prometheus
After=network.target
[Service]
Type=simple
User=prometheus
ExecStart=/opt/prometheus/prometheus --config.file=/opt/prometheus/prometheus.yml --storage.tsdb.path=/opt/prometheus/data 
Restart=on-failure
[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl start prometheus
systemctl status prometheus
systemctl enable prometheus

cat > /etc/systemd/system/node_exporter.service <<EOF
[Unit]
Description=node_exporter
After=network.target
[Service]
Type=simple
User=prometheus
ExecStart=/opt/node_exporter/node_exporter
Restart=on-failure
[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl start node_exporter
systemctl status node_exporter
systemctl enable node_exporter

cat > /etc/systemd/system/alertmanager.service <<EOF
[Unit]
Description=alertmanager
After=network.target
[Service]
Type=simple
User=prometheus
ExecStart=/opt/alertmanager/alertmanager --config.file=/opt/alertmanager/alertmanager.yml --storage.path=/opt/alertmanager/data --cluster.advertise-address=0.0.0.0:9093
Restart=on-failure
[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl start alertmanager
systemctl status alertmanager
systemctl enable alertmanager

#检查服务是否启动
netstat -lntp
能看到prometheus、node-exporter、alertmanager服务已经启动
